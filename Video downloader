<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>video_downloader/
│
├── app.py
├── templates/
│   └── index.html
├── static/
│   └── style.css (optional)
└── requirements.txt
</title>
  <meta name="description" content="ইউটিউব, ফেসবুক, টিকটক ভিডিও ডাউনলোড করুন এক ক্লিকে।">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <h2 class="text-center mb-4">from flask import Flask, render_template, request, jsonify
import yt_dlp

app = Flask(__name__)

@app.route('/')
def home():
    return render_template('index.html')

@app.route('/download', methods=['POST'])
def download():
    data = request.json
    video_url = data.get('url')

    if not video_url:
        return jsonify({'error': 'ভিডিও লিংক প্রয়োজন'}), 400

    try:
        ydl_opts = {
            'quiet': True,
            'skip_download': True,
            'force_generic_extractor': False,
            'format': 'best[ext=mp4]/best',
        }

        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(video_url, download=False)

        title = info.get('title', 'ভিডিও')
        formats = info.get('formats', [])
        videos = []

        for fmt in formats:
            if fmt.get('ext') == 'mp4' and fmt.get('url'):
                resolution = fmt.get('format_note') or fmt.get('height')
                videos.append({
                    'url': fmt['url'],
                    'resolution': resolution,
                    'filesize': fmt.get('filesize') or 0
                })

        if not videos:
            return jsonify({'error': 'ভিডিও পাওয়া যায়নি'}), 404

        return jsonify({
            'title': title,
            'videos': sorted(videos, key=lambda x: x['resolution'] or 0, reverse=True)
        })

    except Exception as e:
        return jsonify({'error': f'ত্রুটি ঘটেছে: {str(e)}'}), 500

if __name__ == '__main__':
    app.run(debug=True)
 </h2>

  <div class="card p-4 shadow-sm">
    <label for="url" class="form-label">ভিডিও লিংক দিন:</label>
    <input type="url" id="url" class="form-control mb-3" placeholder="https://youtube.com/watch?v=...">

    <button onclick="fetchDownloadLinks()" class="btn btn-primary w-100">ডাউনলোড লিংক খুঁজুন</button>
  </div>

  <div id="result" class="mt-4"></div>
</div>

<script>
  async function fetchDownloadLinks() {
    const url = document.getElementById('url').value.trim();
    const result = document.getElementById('result');
    result.innerHTML = '<p>লোড হচ্ছে...</p>';

    const response = await fetch('/download', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url })
    });

    const data = await response.json();
    if (!response.ok) {
      result.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
    } else {
      let html = `<h4>${data.title}</h4><ul class="list-group">`;
      data.videos.forEach(v => {
        html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                  <span>${v.resolution || 'অজানা'}p</span>
                  <a class="btn btn-success btn-sm" href="${v.url}" target="_blank">ডাউনলোড করুন</a>
                </li>`;
      });
      html += '</ul>';
      result.innerHTML = html;
    }
  }
</script>

</body>
</html>
